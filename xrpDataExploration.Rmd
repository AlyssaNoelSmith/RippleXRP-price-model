---
title: "xrpdataexploration"
author: "Alyssa Smith"
date: "4/8/2020"
output: html_document
---

```{r setup, include=FALSE}
library(tseries)
library(Boruta)
library(zoo)
library(vars)
```



```{r}
#Augmented Dickey Fuller Stationarity test for High_XRP
adf.test(data$High_xrp)
```

```{r}
#Perform boruta test for feature selection (wrapper around random forest)
boruta_output <- Boruta(High_xrp ~ ., data=na.omit(data))
# collect Confirmed and Tentative variables
boruta_signif <- names(boruta_output$finalDecision[boruta_output$finalDecision %in% c("Confirmed", "Tentative")]) 
plot(boruta_output, cex.axis=.7, las=2, xlab="", main="Variable Importance")  # plot variable importance
```

```{r}
#Augmented Dickey Fuller Stationarity testing for various highly important predictor variables
adf.test(data$High_btc) #Lag order = 12,p-value = 0.2474
adf.test(data$Adj.Close_btc) #Lag order = 12, p-value = 0.2216
adf.test(data$Low_btc) #Lag order = 12, p-value = 0.3705
adf.test(data$High_oil)#Lag order = 12, p-value = 0.9264
adf.test(data$High_nasdaq) #Lag order = 12, p-value = 0.0293
adf.test(data$Close_oil)#Lag order = 12, p-value = 0.9374
adf.test(data$Close_silver)#Lag order = 12, p-value = 0.2795
adf.test(data$High_silver)#Lag order = 12, p-value = 0.2602
adf.test(data$Low_silver) #Lag order = 12, p-value = 0.3058
adf.test(data$Adj.Close_dow)#Lag order = 12, p-value = 0.3719
adf.test(data$Open_dow)#Lag order = 12, p-value = 0.3989
adf.test(data$Open_nasdaq)#Lag order = 12, p-value = 0.02382


#Experimenting with various lag orders 
adf.test(data$High_btc, k=2) #Lag order = 2, p-value = 0.4582
adf.test(data$High_btc, k=5) #Lag order = 5, p-value = 0.3979
adf.test(data$High_btc, k=20) #Lag order = 20, p-value = 0.183
adf.test(data$High_btc, k=40) #Lag order = 40, p-value = 0.3487
```
```{r}
#Differencing non-stationary variables from above

plot.ts(data$High_btc)
High_btc_diff <- diff(data$High_btc, differences=1)
plot.ts(High_btc_diff)
adf.test(High_btc_diff)


Adj.Close_btc_diff <- diff(data$Adj.Close_btc, differences=1)
plot.ts(Adj.Close_btc_diff)
adf.test(Adj.Close_btc_diff)


Low_btc_diff <- diff(data$Low_btc, differences=1)
plot.ts(Low_btc_diff)
adf.test(Low_btc_diff)


High_oil_diff <- diff(data$High_oil, differences=1)
plot.ts(High_oil_diff)
adf.test(High_oil_diff)


Close_oil_diff <- diff(data$Close_oil, differences=1)
plot.ts(Close_oil_diff)
adf.test(Close_oil_diff)


Close_silver_diff <- diff(data$Close_silver, differences=1)
plot.ts(Close_silver_diff)
adf.test(Close_silver_diff)


High_silver_diff <- diff(data$High_silver, differences=1)
plot.ts(High_silver_diff)
adf.test(High_silver_diff)

Low_silver_diff <- diff(data$Low_silver, differences=1)
plot.ts(Low_silver_diff)
adf.test(Low_silver_diff)

#-------------
Adj.Close_dow_diff <- diff(data$Adj.Close_dow, differences=1)
plot.ts(Adj.Close_dow_diff)
adf.test(Adj.Close_dow_diff)


Open_dow_diff <- diff(data$Open_dow, differences=1)
plot.ts(Open_dow_diff)
adf.test(Open_dow_diff)

#All tested variables successfully passed the ADF stationarity test after lag-1 differencing.
```

```{r}
#Create dataframes for Granger Causality Test to determine importance in predicting High_XRP (using the stationary features above)
#Will need 7 dataframes -> (High_XRP, High_btc_diff), (High_XRP, Low_btc_diff), etc.
#Needed to remove first column of High_xrp because of how the differencing works: the count of the differenced data was one less than the original column
highBTC = data.frame(data$High_xrp[-1], High_btc_diff)
grangertest(highBTC[[1]] ~ highBTC[[2]], order = 3, data = highBTC)  #p-value: 0.00082

lowBTC = data.frame(data$High_xrp[-1], Low_btc_diff)
grangertest(lowBTC[[1]] ~ lowBTC[[2]], order = 3, data = lowBTC)   #p-value: < 2.2e-16

highNASDAQ = data.frame(data$High_xrp, data$High_nasdaq)
grangertest(highNASDAQ[[1]] ~ highNASDAQ[[2]], order = 3, data = highNASDAQ)  #p-value:0.6872 

adjCloseOil = data.frame(data$High_xrp[-1], Adj.Close_oil_diff)
grangertest(adjCloseOil[[1]] ~ adjCloseOil[[2]], order = 3, data = adjCloseOil)#p-value: 

lowOil = data.frame(data$High_xrp[-1], Low_oil_diff)
grangertest(lowOil[[1]] ~ lowOil[[2]], order = 3, data = lowOil)  #p-value: 

openSilver = data.frame(data$High_xrp[-1], Open_silver_diff)
grangertest(openSilver[[1]] ~ openSilver[[2]], order = 3, data = openSilver)#p-value: 

lowSilver = data.frame(data$High_xrp[-1], Low_silver_diff)
Low_silver_diff
lowSilver
grangertest(lowSilver[[1]] ~ lowSilver[[2]], order = 3, data = lowSilver)#p-value: 

lowDow = data.frame(data$High_xrp[-1], Low_dow_diff)
grangertest(lowDow[[1]] ~ lowDow[[2]], order = 3, data = lowDow)#p-value: 0.3733

highSAndP = data.frame(data$High_xrp, data$High_sandp)
grangertest(highSAndP[[1]] ~ highSAndP[[2]], order = 3, data = highSAndP)#p-value: 0.6765

```

